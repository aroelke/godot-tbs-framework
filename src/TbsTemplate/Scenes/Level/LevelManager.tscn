[gd_scene load_steps=22 format=3 uid="uid://p5cw5rndfqun"]

[ext_resource type="Script" path="res://src/TbsTemplate/Scenes/Level/LevelManager.cs" id="1_r2v0t"]
[ext_resource type="PackedScene" uid="uid://dixhxpjk8n4y6" path="res://src/TbsTemplate/UI/Camera2DBrain.tscn" id="3_td8u6"]
[ext_resource type="PackedScene" uid="uid://brgi7pl8xxduv" path="res://src/TbsTemplate/Scenes/Level/Layers/ActionLayers.tscn" id="3_v35i6"]
[ext_resource type="TileSet" uid="uid://cwhi2yq5gtey5" path="res://demo/assets/level/ui/Overlay.tres" id="4_12w8e"]
[ext_resource type="PackedScene" uid="uid://bolt0jtmhdfb8" path="res://src/TbsTemplate/Nodes/StateChart/Reactions/Vector2IReaction.tscn" id="16_kxyas"]
[ext_resource type="PackedScene" uid="uid://cr7p08c3td7gg" path="res://src/TbsTemplate/Nodes/StateChart/Chart.tscn" id="17_sd0pe"]
[ext_resource type="PackedScene" uid="uid://bykdjiak4bxvt" path="res://src/TbsTemplate/Nodes/StateChart/States/CompoundState.tscn" id="18_k7m3y"]
[ext_resource type="PackedScene" uid="uid://dnfp4qfxs85wh" path="res://src/TbsTemplate/Nodes/StateChart/States/HistoryState.tscn" id="18_n547p"]
[ext_resource type="PackedScene" uid="uid://lrf5ywt1n230" path="res://src/TbsTemplate/Nodes/StateChart/States/AtomicState.tscn" id="19_o30vs"]
[ext_resource type="PackedScene" uid="uid://0b22cirxc7k2" path="res://src/TbsTemplate/Nodes/StateChart/States/Transition.tscn" id="20_p4yt1"]
[ext_resource type="PackedScene" uid="uid://dxamaj2vnf0lt" path="res://src/TbsTemplate/Scenes/Level/UnitReaction.tscn" id="21_sbtfw"]
[ext_resource type="PackedScene" uid="uid://hri0gp84mgng" path="res://src/TbsTemplate/Scenes/Level/PathReaction.tscn" id="22_h5tkx"]
[ext_resource type="PackedScene" uid="uid://6l44mlff5sgr" path="res://src/TbsTemplate/Nodes/StateChart/Reactions/ActionReaction.tscn" id="22_mocgv"]
[ext_resource type="PackedScene" uid="uid://8kjm1k78c32w" path="res://src/TbsTemplate/Scenes/Level/CommandReaction.tscn" id="27_7kdnf"]
[ext_resource type="Script" path="res://src/TbsTemplate/Nodes/StateChart/Conditions/IntCondition.cs" id="27_kyhbc"]
[ext_resource type="PackedScene" uid="uid://bxjlkc4hevsxb" path="res://src/TbsTemplate/Scenes/Level/TargetReaction.tscn" id="28_5f3xe"]
[ext_resource type="PackedScene" uid="uid://b7i65c130fgfs" path="res://src/TbsTemplate/Nodes/StateChart/Reactions/EnterTreeReaction.tscn" id="29_o6hju"]
[ext_resource type="AudioStream" uid="uid://dx4swhb5suesh" path="res://demo/assets/raw/JDSherbert - Ultimate UI SFX Pack/Free/Mono/wav (HD)/JDSherbert - Ultimate UI SFX Pack - Popup Open - 1.wav" id="31_yh2xe"]
[ext_resource type="AudioStream" uid="uid://fpepi63ytykk" path="res://demo/assets/raw/JDSherbert - Ultimate UI SFX Pack/Free/Mono/wav (HD)/JDSherbert - Ultimate UI SFX Pack - Popup Close - 1.wav" id="32_e2hk2"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_spp7l"]
seed = -1400462818

[sub_resource type="Resource" id="Resource_3lvnu"]
script = ExtResource("27_kyhbc")
Value = 0
Comparison = "="
Number = &"active"

[node name="LevelManager" type="Node"]
script = ExtResource("1_r2v0t")
Select = &"select"
Cancel = &"cancel"
Skip = &"skip"
Wait = &"wait"
Done = &"done"
CombatScenePath = "res://src/TbsTemplate/Scenes/Combat/CombatScene.tscn"

[node name="Camera" parent="." instance=ExtResource("3_td8u6")]
unique_name_in_owner = true
Limits = Rect2i(0, 0, 1000000, 1000000)
Zoom = Vector2(2, 2)
ShakeDecay = 0.8
ShakeMaxOffset = Vector2(100, 75)
ShakeMaxRoll = 0.0
ShakeNoise = SubResource("FastNoiseLite_spp7l")

[node name="ZoneLayers" parent="." instance=ExtResource("3_v35i6")]
unique_name_in_owner = true
ShowUnion = true

[node name="TraversableZone" type="TileMapLayer" parent="ZoneLayers"]
modulate = Color(0, 0.247059, 0.498039, 0.392157)
use_parent_material = true
tile_set = ExtResource("4_12w8e")
navigation_enabled = false

[node name="LocalDangerZone" type="TileMapLayer" parent="ZoneLayers"]
modulate = Color(0.498039, 0, 0.247059, 0.392157)
use_parent_material = true
tile_set = ExtResource("4_12w8e")
navigation_enabled = false

[node name="GlobalDangerZone" type="TileMapLayer" parent="ZoneLayers"]
modulate = Color(0, 0, 0, 0.392157)
use_parent_material = true
tile_set = ExtResource("4_12w8e")
navigation_enabled = false

[node name="UserInterface" type="CanvasLayer" parent="."]
unique_name_in_owner = true

[node name="TurnLabel" type="Label" parent="UserInterface"]
unique_name_in_owner = true
offset_right = 213.0
offset_bottom = 45.0
theme_override_font_sizes/font_size = 32
text = "Turn 1: Player"

[node name="State" parent="." instance=ExtResource("17_sd0pe")]
unique_name_in_owner = true
Events = [&"select", &"cancel", &"skip", &"wait", &"done"]

[node name="Root" parent="State" node_paths=PackedStringArray("InitialState") instance=ExtResource("18_k7m3y")]
process_mode = 4
InitialState = NodePath("Running")

[node name="Running" parent="State/Root" node_paths=PackedStringArray("InitialState") instance=ExtResource("18_k7m3y")]
process_mode = 4
InitialState = NodePath("BeginTurn")

[node name="History" parent="State/Root/Running" node_paths=PackedStringArray("DefaultState") instance=ExtResource("18_n547p")]
DefaultState = NodePath("../Idle")

[node name="BeginTurn" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="ToIdle" parent="State/Root/Running/BeginTurn" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../Idle")

[node name="Idle" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="OnCursorMoved" parent="State/Root/Running/Idle" instance=ExtResource("16_kxyas")]

[node name="OnCursorEnteredCell" parent="State/Root/Running/Idle" instance=ExtResource("16_kxyas")]

[node name="OnUnitSelected" parent="State/Root/Running/Idle" instance=ExtResource("21_sbtfw")]

[node name="OnTurnSkipped" parent="State/Root/Running/Idle" instance=ExtResource("22_mocgv")]

[node name="ToSelected" parent="State/Root/Running/Idle" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"select"
To = NodePath("../../UnitSelected")

[node name="ToEndTurn" parent="State/Root/Running/Idle" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"skip"
To = NodePath("../../EndTurn")

[node name="UnitSelected" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="OnUnitCommanded" parent="State/Root/Running/UnitSelected" instance=ExtResource("27_7kdnf")]

[node name="OnTargetChosen" parent="State/Root/Running/UnitSelected" instance=ExtResource("28_5f3xe")]

[node name="OnPathConfirmed" parent="State/Root/Running/UnitSelected" instance=ExtResource("22_h5tkx")]

[node name="ToMoving" parent="State/Root/Running/UnitSelected" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"select"
To = NodePath("../../UnitMoving")

[node name="ToIdle" parent="State/Root/Running/UnitSelected" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"cancel"
To = NodePath("../../Idle")

[node name="UnitMoving" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="ToCommanding" parent="State/Root/Running/UnitMoving" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../UnitCommanding")

[node name="ToCombat" parent="State/Root/Running/UnitMoving" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"skip"
To = NodePath("../../InCombat")

[node name="UnitCommanding" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="OnUnitCommanded" parent="State/Root/Running/UnitCommanding" instance=ExtResource("27_7kdnf")]

[node name="ToTargeting" parent="State/Root/Running/UnitCommanding" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"select"
To = NodePath("../../UnitTargeting")

[node name="ToSelected" parent="State/Root/Running/UnitCommanding" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"cancel"
To = NodePath("../../UnitSelected")

[node name="ToEndAction" parent="State/Root/Running/UnitCommanding" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"skip"
To = NodePath("../../EndAction")

[node name="UnitTargeting" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="OnTargetChosen" parent="State/Root/Running/UnitTargeting" instance=ExtResource("28_5f3xe")]

[node name="ToCommanding" parent="State/Root/Running/UnitTargeting" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"cancel"
To = NodePath("../../UnitCommanding")

[node name="ToCombat" parent="State/Root/Running/UnitTargeting" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../InCombat")

[node name="ToEndAction" parent="State/Root/Running/UnitTargeting" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"skip"
To = NodePath("../../EndAction")

[node name="InCombat" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="OnEnteredTree" parent="State/Root/Running/InCombat" instance=ExtResource("29_o6hju")]

[node name="ToEndAction" parent="State/Root/Running/InCombat" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../EndAction")

[node name="EndAction" parent="State/Root/Running" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="ToEndTurn" parent="State/Root/Running/EndAction" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../EndTurn")
Condition = SubResource("Resource_3lvnu")

[node name="ToIdle" parent="State/Root/Running/EndAction" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../Idle")

[node name="EndTurn" parent="State/Root/Running" instance=ExtResource("19_o30vs")]

[node name="ToBeginTurn" parent="State/Root/Running/EndTurn" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../BeginTurn")

[node name="ToWaiting" parent="State/Root/Running" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"wait"
To = NodePath("../../Waiting")

[node name="Waiting" parent="State/Root" instance=ExtResource("19_o30vs")]
process_mode = 4

[node name="ToActive" parent="State/Root/Waiting" node_paths=PackedStringArray("To") instance=ExtResource("20_p4yt1")]
Event = &"done"
To = NodePath("../../Running/History")

[node name="TurnAdvance" type="Timer" parent="."]
unique_name_in_owner = true
one_shot = true

[node name="SoundLibrary" type="Node" parent="."]

[node name="ZoneOnSound" type="AudioStreamPlayer" parent="SoundLibrary"]
unique_name_in_owner = true
stream = ExtResource("31_yh2xe")

[node name="ZoneOffSound" type="AudioStreamPlayer" parent="SoundLibrary"]
unique_name_in_owner = true
stream = ExtResource("32_e2hk2")

[connection signal="child_entered_tree" from="." to="." method="OnChildEnteredTree"]
[connection signal="StateEntered" from="State/Root/Running/BeginTurn" to="." method="OnBeginTurnEntered"]
[connection signal="StateExited" from="State/Root/Running/BeginTurn" to="." method="OnBeginTurnExited"]
[connection signal="EventReceived" from="State/Root/Running/Idle" to="." method="OnIdleEventReceived"]
[connection signal="StateEntered" from="State/Root/Running/Idle" to="." method="OnIdleEntered"]
[connection signal="StateUpdated" from="State/Root/Running/Idle/OnCursorMoved" to="." method="OnIdleCursorMoved"]
[connection signal="StateUpdated" from="State/Root/Running/Idle/OnCursorEnteredCell" to="." method="OnIdleCursorEnteredCell"]
[connection signal="StateUpdated" from="State/Root/Running/Idle/OnUnitSelected" to="." method="OnIdleUnitSelected"]
[connection signal="StateUpdated" from="State/Root/Running/Idle/OnTurnSkipped" to="." method="OnIdleTurnSkipped"]
[connection signal="StateEntered" from="State/Root/Running/UnitSelected" to="." method="OnSelectedEntered"]
[connection signal="StateExited" from="State/Root/Running/UnitSelected" to="." method="OnSelectedExited"]
[connection signal="StateUpdated" from="State/Root/Running/UnitSelected/OnUnitCommanded" to="." method="OnSelectedUnitCommanded"]
[connection signal="StateUpdated" from="State/Root/Running/UnitSelected/OnTargetChosen" to="." method="OnSelectedTargetChosen"]
[connection signal="StateUpdated" from="State/Root/Running/UnitSelected/OnPathConfirmed" to="." method="OnSelectedPathConfirmed"]
[connection signal="Taken" from="State/Root/Running/UnitSelected/ToMoving" to="." method="OnDestinationChosen"]
[connection signal="Taken" from="State/Root/Running/UnitSelected/ToIdle" to="." method="OnSelectedCanceled"]
[connection signal="EventReceived" from="State/Root/Running/UnitMoving" to="." method="OnMovingEventReceived"]
[connection signal="StateEntered" from="State/Root/Running/UnitMoving" to="." method="OnMovingEntered"]
[connection signal="StateExited" from="State/Root/Running/UnitMoving" to="." method="OnMovingExited"]
[connection signal="StateEntered" from="State/Root/Running/UnitCommanding" to="." method="OnCommandingEntered"]
[connection signal="StateUpdated" from="State/Root/Running/UnitCommanding/OnUnitCommanded" to="." method="OnCommandingUnitCommanded"]
[connection signal="Taken" from="State/Root/Running/UnitCommanding/ToSelected" to="." method="OnCommandingCanceled"]
[connection signal="Taken" from="State/Root/Running/UnitCommanding/ToEndAction" to="." method="OnTurnEndCommand"]
[connection signal="StateEntered" from="State/Root/Running/UnitTargeting" to="." method="OnTargetingEntered"]
[connection signal="StateExited" from="State/Root/Running/UnitTargeting" to="." method="OnTargetingExited"]
[connection signal="StateUpdated" from="State/Root/Running/UnitTargeting/OnTargetChosen" to="." method="OnTargetChosen"]
[connection signal="Taken" from="State/Root/Running/UnitTargeting/ToCombat" to="." method="OnTargetingExited"]
[connection signal="StateEntered" from="State/Root/Running/InCombat" to="." method="OnCombatEntered"]
[connection signal="StateExited" from="State/Root/Running/InCombat" to="." method="OnCombatExited"]
[connection signal="StateEnteredTree" from="State/Root/Running/InCombat/OnEnteredTree" to="." method="OnCombatEnteredTree"]
[connection signal="StateEntered" from="State/Root/Running/EndAction" to="." method="OnEndActionEntered"]
[connection signal="StateExited" from="State/Root/Running/EndAction" to="." method="OnEndActionExited"]
[connection signal="StateEntered" from="State/Root/Running/EndTurn" to="." method="OnEndTurnEntered"]
[connection signal="StateExited" from="State/Root/Running/EndTurn" to="." method="OnEndTurnExited"]
